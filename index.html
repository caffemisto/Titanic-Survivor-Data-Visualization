<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">    
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  
      <style>
        h2 {
          color: black;
          text-align: center;
        }

        .axis {
          font-family: arial;
          font-size: 0.6em;
        }

        path {
          fill: none;
          stroke: black;
          stroke-width: 2px;
        }

        .tick {
          fill: none;
          stroke: black;
        }
      </style>

    <script type="text/javascript">

      //create function for drawing the chart
      function draw(data) {

          //set the height, width, and margin size
          "use strict";
          var margin = 75,
              width = 1400 - margin,
              height = 600 - margin;


          //run a nesting function to count the number
          //of data points in each passenger data class
          var class_count = d3.nest()
            .key(function(d) { return d.Pclass; })
            .rollup(function(v) {return {"total" : v.length,
                                         "Survived" : d3.sum(v, 
                                          function(d) {return d.Survived;}),
                                         "Died" : v.length - d3.sum(v,
                                          function(d) {return d.Survived;})
                                        }
                                })
            .entries(data);
          
          debugger;

          //create the header title of the graphic
          d3.select("body")
            .append("h2")
            .text("Mortality of Titanic Passengers");

          //create the svg in which the graphic will appear
          var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
            .append('g')
            .attr('class', 'map');

          //determine the extent of data we will be using for
          //passenger class
          var x_extent = d3.extent(data, function(d) {
              return d['Pclass'];
          });

          //scale the passenger class data we have
          //using the extent we created
          var x_scale = d3.scale.ordinal()
                                .domain(['1', '2', '3'])
                                .rangeBands([margin, width], .4, .2);

          //build the x axis with the appropriate scale
          var x_axis = d3.svg.axis()
                             .scale(x_scale)
                             .orient('bottom');
          
          //append the x axis to the svg
          d3.select("svg")
             .append("g")
             .attr("class", "x axis")
             .attr('transform', "translate(0," + height + ")")
             .call(x_axis);

          //determine the maximum passenger count for any given class
          var class_max = d3.max(class_count, function(d) {
              return d.values['total'];
          });

          //determine the extent of data we will be using for
          //survival data
          var y_extent = d3.extent([0,class_max + 100]);

          //scale the survival data we have
          //using the extent we created
          var y_scale = d3.scale.linear()
                                .range([height, margin])
                                .domain(y_extent);
                                
          //build the x axis with the appropriate scale
          var y_axis = d3.svg.axis()
                             .scale(y_scale)
                             .orient("left");
                             
          //append the y axis to the svg
          d3.select("svg")
            .append('g')
            .attr('class', 'y axis')
            .attr('transform', "translate(" + margin + ",0)")
            .call(y_axis);
 
          //append the bars to the svg
          svg.append('g')
             .attr("class", "chart")
             .selectAll("rect")
             .data(class_count)
             .enter()
             .append('rect')
             .attr('x', function(d) {
                  return x_scale(d.key);
              })
             .attr('y', function(d) {
                  return y_scale(d.values['Survived']);
              })
             .attr('height', function(d) {
                  return height - y_scale(d.values['Survived']);
              })
             .attr('width', function(d) {
                  return x_scale.rangeBand();
              })
             .attr('fill', 'steelblue')
             .attr('stroke', 'black');
             
        };
    </script>      
  </head>
<body>
  <script>

  //read in the data csv and run the charting function
  d3.csv("titanic.csv", function(d) {
      d['Survived'] = +d['Survived'];
      return d;
  }, draw);
  
  </script>
</body>
</html>
