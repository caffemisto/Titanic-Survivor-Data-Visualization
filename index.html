<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">    
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  
      <style>
        h2 {
          color: black;
          text-align: center;
        }

        .axis {
          font-family: arial;
          font-size: 0.6em;
        }

        path {
          fill: none;
          stroke: black;
          stroke-width: 2px;
        }

        .tick {
          fill: none;
          stroke: black;
        }
      </style>

    <script type="text/javascript">

      function draw(data) {

          "use strict";
          var margin = 75,
              width = 1400 - margin,
              height = 600 - margin;

          

          //run a nesting function to sort the data by class
          var data_by_class = d3.nest()
            .key(function(d) { return d.Pclass; })
            .entries(data);

          //run a nesting function to count the number
          //of data points in each passenger data class
          var class_count = d3.nest()
            .key(function(d) { return d.Pclass; })
            .rollup(function(v) { return v.length;})
            .entries(data);
          
          var class_total = d3.nest()
            .key(function(d) {return d.Pclass;})
            .rollup(function(v) { return {
               total: d3.sum(v, function(d) { return d.Survived; })
             }; })
            .entries(data);

          var class_max = d3.max(class_count, function(d) {
              return d.values;
          });

          debugger;

          //create the header title of the graphic
          d3.select("body")
            .append("h2")
            .text("Mortality of Titanic Passengers");

          //create the svg in which the graphic will appear
          var svg = d3.select("body")
            .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
            .append('g')
            .attr('class', 'map');





          //determine the extent of data we will be using for
          //passenger class
          var x_extent = d3.extent(data, function(d) {
              return d['Pclass'];
          });

          //scale the passenger class data we have
          //using the extent we created
          var x_scale = d3.scale.ordinal()
                                .domain(['1', '2', '3'])
                                .rangeBands([margin, width], .2, .1);

          //build the x axis with the appropriate scale
          var x_axis = d3.svg.axis()
                             .scale(x_scale)
                             .orient('bottom');
          
          //append the x axis to the svg
          d3.select("svg")
             .append("g")
             .attr("class", "x axis")
             .attr('transform', "translate(0," + height + ")")
             .call(x_axis);

          //determine the extent of data we will be using for
          //survival data
          var y_extent = d3.extent([0,class_max + 100]);

          //(data, function(d) {
          //    return d['Survived'];
          //});

          //scale the survival data we have
          //using the extent we created
          var y_scale = d3.scale.linear()
                                .range([height, margin])
                                .domain(y_extent);
                                

          //build the x axis with the appropriate scale
          var y_axis = d3.svg.axis()
                             .scale(y_scale)
                             .orient("left");
                             

          //append the y axis to the svg
          d3.select("svg")
            .append('g')
            .attr('class', 'y axis')
            .attr('transform', "translate(" + margin + ",0)")
            .call(y_axis);
 
/*          //create the rectangle objects which will make up the bars 
          //in this barchart
          d3.select('svg')
            .selectAll("rect")
            .data(data)
            .enter()
            .append("rect"); */

          svg.append('g')
             .attr("class", "chart")
             .selectAll("rect")
             .data(class_total)
             .enter()
             .append('rect')
             .attr('x', function(d) {
                  return x_scale(d.key);
              })
             .attr('y', function(d) {
                  return y_scale(d.values['total']);
              })
             .attr('height', function(d) {
                  return height - y_scale(d.values['total']);
              })
             .attr('width', function(d) {
                  return x_scale.rangeBand();
              })
             .attr('fill', 'steelblue')
             .attr('stroke', 'black');
              debugger; 


/*          d3.selectAll('rect')
              .attr('x', function(d) {
                  return x_scale(d['Pclass']);
              })
              .data(class_total)
              .attr('y', function(d) {
                  return y_scale(d.values['total']);
              })
              .attr('height', function(d) {
                  return y_scale(0);
              })
              .attr('width', function(d) {
                  return 200;

              })
              .attr('fill', function(d) {
                  return 'steelblue'
              }); */
              debugger;
        };
    </script>      
  </head>
<body>
  <script>

  //read in the data csv and run the charting function
  d3.csv("titanic.csv", function(d) {
      d['Survived'] = +d['Survived'];
      return d;
  }, draw);
  
  </script>
</body>
</html>
